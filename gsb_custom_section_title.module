<?php

/**
 * @file
 * Allows customized section titles.
 */

/**
 * Implements hook_menu().
 */
function gsb_custom_section_title_menu() {
  $items = array();
  $items['admin/config/gsb/custom-section-title'] = array(
    'title' => 'Custom Section Titles',
    'description' => 'Manage custom section titles',
    'route_name' => 'gsb_custom_section_title.configure',
  );
  return $items;
}

/**
 * Implements hook_permission().
 */
function gsb_custom_section_title_permission() {
  return array(
    'administer custom section titles' => array(
      'title' => t('Administer custom section titles'),
    ),
  );
}

/**
 * Gets the custom section title for a given key.
 *
 * @param int|string $key
 *   The specific section.
 *
 * @return array
 *   An array representing the custom section title.
 */
function gsb_custom_section_title_get_section($key) {
  $sections = \Drupal::config('gsb_custom_section_title.settings')->get('sections');
  if (!isset($sections[$key])) {
    $sections[$key] = array(
      'title' => '',
      'link' => FALSE,
      'link_path' => '',
      'paths' => '',
    );
  }
  return $sections[$key];
}

/**
 * Sets the custom section titles.
 *
 * @param array $sections
 *   An array of custom section titles.
 */
function gsb_custom_section_title_set_sections(array $sections) {
  $sections = array_values($sections);
  foreach ($sections as $key => $section) {
    $section['id'] = $key;
  }
  \Drupal::config('gsb_custom_section_title.settings')->set('sections', $sections)->save();
}

/**
 * Implements hook_theme().
 */
function gsb_custom_section_title_theme($existing, $type, $theme, $path) {
  return array(
    'gsb_custom_section_title_table' => array(
      'render element' => 'form',
    ),
  );
}

/**
 * Returns HTML for the custom section title table.
 */
function theme_gsb_custom_section_title_table($variables) {
  $form = $variables['form'];
  if (!empty($form['operations'])) {
    foreach (element_children($form['operations']) as $key) {
      $form['table']['#rows'][$key]['data'][]['data'] = $form['operations'][$key];
      hide($form['operations'][$key]);
    }
  }
  return drupal_render_children($form);
}
